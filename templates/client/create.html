{% extends "base.html" %}
{% load static %}
{% block title %}Mijoz qo'shish - Major Consulting{% endblock title %}

{% block item %}
<style>
  .form-section {
    background-color: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    border-left: 4px solid #0d6efd;
  }
  
  .form-control:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
  
  .input-group-text {
    background-color: #f8f9fa;
  }
  
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>

<div class="app-container">
    <div class="app-hero-header d-flex align-items-center">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <i class="ri-home-8-line lh-1 pe-3 me-3 border-end"></i>
          <a href="/">Asosiy</a>
        </li>
        <li class="breadcrumb-item">
            <a href="/client">Mijozlar</a>
          </li>
        <li class="breadcrumb-item text-primary" aria-current="page">
          Mijoz qo'shish
        </li>
      </ol>
    </div>

    <div class="app-body animate-fade-in">
      {% include 'messages.html' %}

      <div class="row gx-3">
        <div class="col-xl-12">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-white py-3">
              <h5 class="card-title mb-0 d-flex align-items-center">
                <i class="ri-user-add-line me-2 text-primary"></i>
                Yangi mijoz qo'shish
              </h5>
            </div>
            <div class="card-body">
              <form method="POST">
                {% csrf_token %}
                
                <div class="form-section mb-4">
                  <h6 class="mb-3 text-primary">
                    <i class="ri-information-line me-2"></i> Mijoz ma'lumotlari
                  </h6>
                  
                  <div class="row g-3">
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="firstName">
                          Ism <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-user-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="first_name" 
                            id="firstName" 
                            placeholder="Ism" 
                            required
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="lastName">
                          Familiya <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-user-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="last_name" 
                            id="lastName" 
                            placeholder="Familiya" 
                            required
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="middleName">
                          Sharif
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-user-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="middle_name" 
                            id="middleName" 
                            placeholder="Sharif"
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="phone-input">
                          Telefon raqami <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-phone-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control phone-input" 
                            name="phone" 
                            id="phone-input" 
                            placeholder="+998 90 123 45 67" 
                            required
                          >
                        </div>
                        <div class="form-text">
                          <i class="ri-information-line me-1"></i> Telefon raqamini to'g'ri formatda kiriting
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="phone2-input">
                          Qo'shimcha telefon
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-phone-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control phone-input" 
                            name="phone2" 
                            id="phone2-input" 
                            placeholder="+998 90 123 45 67"
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="passport_number">
                          Passport raqami
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-id-card-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="passport_number" 
                            id="passport_number" 
                            placeholder="AA1234567"
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="passport_issue_date">
                          Passport berilgan sana
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-calendar-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="passport_issue_date" 
                            id="passport_issue_date" 
                            placeholder="01.01.2020"
                            data-date-mask="true"
                          >
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="passport_expiry_date">
                          Passport tugash sanasi
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-calendar-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="passport_expiry_date" 
                            id="passport_expiry_date" 
                            placeholder="01.01.2030"
                            data-date-mask="true"
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="passport_issue_place">
                          Passport bergan tashkilot
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-building-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="passport_issue_place" 
                            id="passport_issue_place" 
                            placeholder="MIB, IIB va h.k."
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="birth_date">
                          Tug'ilgan sana
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-calendar-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="birth_date" 
                            id="birth_date"
                            placeholder="01.01.2000"
                            data-date-mask="true"
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-12">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="address">
                          Yashash manzili
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-map-pin-line text-primary"></i>
                          </span>
                          <input 
                            type="text" 
                            class="form-control" 
                            name="address" 
                            id="address" 
                            placeholder="Manzilni kiriting"
                          >
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label class="form-label fw-medium" for="heardSource">
                          Qayerda eshitgan <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="ri-information-line text-primary"></i>
                          </span>
                          <input 
                            type="text"
                            class="form-control"
                            name="heard"
                            id="heardSource"
                            placeholder="Masalan: Instagram, Telegram, tanishlar..."
                            required
                          >
                        </div>
                      </div>
                    </div>

                  </div>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                  <a href="/client" class="btn btn-outline-secondary">
                    <i class="ri-arrow-left-line me-1"></i> Bekor qilish
                  </a>
                  <button type="submit" class="btn btn-primary">
                    <i class="ri-save-line me-1"></i> Saqlash
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>

<script>
  // Phone number formatting
  function formatPhone(input) {
    if (!input) return;
    input.addEventListener('input', function() {
      let digits = this.value.replace(/\D/g, '').slice(0, 12);

      // Prefer Uzbekistan format if prefix 998
      if (digits.startsWith('998')) {
        let rest = digits.slice(3);
        let formatted = '+998';
        if (rest.length > 0) formatted += ' ' + rest.slice(0, 2);
        if (rest.length > 2) formatted += ' ' + rest.slice(2, 5);
        if (rest.length > 5) formatted += ' ' + rest.slice(5, 7);
        if (rest.length > 7) formatted += ' ' + rest.slice(7, 9);
        if (rest.length > 9) formatted += ' ' + rest.slice(9, 11);
        this.value = formatted;
        return;
      }

      // Fallback generic grouping (2-3-2-2)
      if (digits.length <= 2) {
        this.value = digits;
      } else if (digits.length <= 5) {
        this.value = digits.slice(0, 2) + ' ' + digits.slice(2);
      } else if (digits.length <= 7) {
        this.value = digits.slice(0, 2) + ' ' + digits.slice(2, 5) + ' ' + digits.slice(5);
      } else {
        this.value = digits.slice(0, 2) + ' ' + digits.slice(2, 5) + ' ' + digits.slice(5, 7) + ' ' + digits.slice(7, 9);
      }
    });
  }
  
  formatPhone(document.getElementById('phone-input'));
  formatPhone(document.getElementById('phone2-input'));
  
  // Passport number formatting
  const passportInput = document.getElementById('passport_number');
  if (passportInput) {
    passportInput.addEventListener('input', function(e) {
      let v = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
      let letters = v.slice(0, 2).replace(/[^A-Z]/g, '');
      let digits = v.slice(2).replace(/\D/g, '').slice(0, 7);
      this.value = letters + digits;
    });
  }
  
  // Date mask
  const dateInput = document.getElementById('passport_issue_date');
  const dateExpiryInput = document.getElementById('passport_expiry_date');
  function attachDateMask(input) {
    if (!input) return;
    input.addEventListener('input', function(e) {
      let value = this.value.replace(/\D/g, '');
      if (value.length >= 2) {
        value = value.slice(0, 2) + '.' + value.slice(2);
      }
      if (value.length >= 5) {
        value = value.slice(0, 5) + '.' + value.slice(5, 9);
      }
      this.value = value;
    });
  }
  attachDateMask(dateInput);
  attachDateMask(dateExpiryInput);
</script>
{% endblock item %}
